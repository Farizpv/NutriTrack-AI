{% extends "base.html" %}
{% block content %}
<div class="container mt-4">
    <h2>Your Health Profile & Goals</h2>
    <p class="text-muted mb-4">This is your health summary. Click "Edit Details" to update it.</p>

    <div class="card p-4 shadow-sm mb-4">
        <div class="row">
            <div class="col-md-6">
                <h5><strong>Your Details</strong></h5>
                <ul class="list-group list-group-flush">
                    <li class="list-group-item"><strong>Date of Birth:</strong> {{ current_user.dob.strftime('%B %d, %Y') if current_user.dob else 'Not Set' }}</li>
                    <li class="list-group-item"><strong>Gender:</strong> {{ current_user.gender or 'Not Set' }}</li>
                    <li class="list-group-item"><strong>Height:</strong> {{ current_user.height_cm or 'N/A' }} cm</li>
                    <li class="list-group-item"><strong>Weight:</strong> {{ current_user.weight_kg or 'N/A' }} kg</li>
                    <li class="list-group-item"><strong>Activity Level:</strong> {{ current_user.activity_level or 'Not Set' }}</li>
                </ul>
            </div>
            <div class="col-md-6">
                <h5><strong>Your Targets</strong></h5>
                <ul class="list-group list-group-flush">
                    <li class="list-group-item"><strong>Calculated BMI:</strong> {{ bmi or 'N/A' }}</li>
                    <li class="list-group-item"><strong>Daily Calorie Target:</strong> <span class="badge bg-success fs-6">{{ recommended_calories or 'N/A' }} kcal</span></li>
                    <li class="list-group-item"><strong>Your Goal:</strong> <span class="badge bg-info fs-6">{{ current_user.goal or 'Not Set' }}</span></li>
                </ul>
            </div>
        </div>
        <div class="mt-4">
             <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#editDetailsModal">
                Edit Details
            </button>
        </div>
    </div>
</div>

<div class="modal fade" id="editDetailsModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Update Your Health Details</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form method="POST" action="{{ url_for('auth.health_details') }}">
                    <div class="row g-3">
                         <div class="col-md-6 mb-3">
                            <label class="form-label">Date of Birth</label>
                            <input type="date" name="dob" class="form-control" value="{{ current_user.dob.strftime('%Y-%m-%d') if current_user.dob else '' }}" max="{{ max_date }}" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Gender</label>
                            <select name="gender" class="form-select" required>
                                <option value="Male" {% if current_user.gender == 'Male' %}selected{% endif %}>Male</option>
                                <option value="Female" {% if current_user.gender == 'Female' %}selected{% endif %}>Female</option>
                            </select>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Height (cm)</label>
                            <input type="number" step="0.1" name="height_cm" class="form-control" value="{{ current_user.height_cm or '' }}" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Weight (kg)</label>
                            <input type="number" step="0.1" name="weight_kg" class="form-control" value="{{ current_user.weight_kg or '' }}" required>
                        </div>
                        <div class="col-12 mb-3">
                            <label class="form-label">Activity Level</label>
                            <select name="activity_level" class="form-select" required>
                                <option value="Sedentary" {% if current_user.activity_level == 'Sedentary' %}selected{% endif %}>Sedentary</option>
                                <option value="Lightly Active" {% if current_user.activity_level == 'Lightly Active' %}selected{% endif %}>Lightly Active</option>
                                <option value="Moderately Active" {% if current_user.activity_level == 'Moderately Active' %}selected{% endif %}>Moderately Active</option>
                                <option value="Very Active" {% if current_user.activity_level == 'Very Active' %}selected{% endif %}>Very Active</option>
                            </select>
                        </div>
                        <div class="col-12 mb-3">
                            <label class="form-label">Your Primary Goal</label>
                            <select name="goal" class="form-select" required>
                                <option value="Maintain Weight" {% if current_user.goal == 'Maintain Weight' %}selected{% endif %}>Maintain Weight</option>
                                <option value="Weight Loss" {% if current_user.goal == 'Weight Loss' %}selected{% endif %}>Weight Loss</option>
                                <option value="Weight Gain" {% if current_user.goal == 'Weight Gain' %}selected{% endif %}>Weight Gain</option>
                            </select>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                        <button type="submit" class="btn btn-success">Save Changes</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}