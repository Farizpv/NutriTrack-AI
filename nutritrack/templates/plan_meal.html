{% extends "base.html" %}
{% block content %}

<div class="container mt-4">

    <div class="mx-auto" style="max-width: 700px;"><h2>Plan a Custom Meal</h2>
    <p class="text-muted mb-4">Generate a personalized meal based on your needs.</p>
    <form method="POST" class="row g-3">
        <div class="col-12">
            <textarea name="requirements" class="form-control" rows="3" required placeholder="Your Requirements (e.g., high protein, vegetarian, under 500 kcal...)"></textarea>
        </div>
        <div class="col-12 mb-3">
        <button type="submit" class="btn btn-success w-100 py-2">Generate Meal Plan</button>
        </div>
    </form>
    </div>

    {% if meal_plan %}
    <hr>
    <h4 class="mt-4">Suggested Meal Plan:</h4>

    {% set data = meal_plan %}

    <div class="card p-4 mb-4">
        <h5><strong>Meal Name:</strong> {{ data.meal_name }}</h5>

        <h6 class="mt-3">Ingredients:</h6>
        <ul>
            {% for ingredient in data.ingredients %}
            <li>{{ ingredient }}</li>
            {% endfor %}
        </ul>

        <h6 class="mt-3">Preparation:</h6>
        <p>{{ data.preparation }}</p>

        <h6 class="mt-3">Nutritional Breakdown:</h6>
        <ul class="list-group mb-3">
            <li class="list-group-item"><strong>Calories:</strong> {{ data.nutrition.calories }} kcal</li>
            <li class="list-group-item"><strong>Protein:</strong> {{ data.nutrition.protein }} g</li>
            <li class="list-group-item"><strong>Carbohydrates:</strong> {{ data.nutrition.carbs }} g</li>
            <li class="list-group-item"><strong>Fats:</strong> {{ data.nutrition.fats }} g</li>
            <li class="list-group-item"><strong>Sugars:</strong> {{ data.nutrition.sugars }} g</li>
            <li class="list-group-item"><strong>Fibre:</strong> {{ data.nutrition.fibre }} g</li>
        </ul>

        {% if data.vitamins %}
        <h6 class="mt-3">Vitamins:</h6>
        <ul>
            {% for vitamin, val in data.vitamins.items() %}
            <li>{{ vitamin }}: {{ val }} {{ 'mg' if vitamin == 'Vitamin C' else 'mcg' }}</li>
            {% endfor %}
        </ul>
        {% endif %}

        {% if data.minerals %}
        <h6 class="mt-3">Minerals:</h6>
        <ul>
            {% for mineral, val in data.minerals.items() %}
            <li>{{ mineral }}: {{ val }} mg</li>
            {% endfor %}
        </ul>
        {% endif %}

        {% if data.insights %}
        <div class="alert alert-info mt-3">
            <strong>Insight:</strong> {{ data.insights }}
        </div>
        {% endif %}
    </div>
    {% endif %}
</div>

{% endblock %}
